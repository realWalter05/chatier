<!DOCTYPE html>
<html>
<head>
	<title>Chat lol</title>
  	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
	<script src="https://cdn.socket.io/4.5.0/socket.io.min.js" integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k" crossorigin="anonymous"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../static/main.js"></script>
</head>
<body>
	<header>
        <nav class="navbar navbar-expand-sm navbar-default navbar-dark sticky-top">
            <a class="navbar-brand">Chatting lol</a>
        </nav>
	</header>
	<main class="m-5">

		<section class="row">	

			<h1>Chatting app</h1>

			<section class="col">	
				<div class="row">
					<input type="text" class="form-control col" id="username-input" placeholder="Username"/>
					<button id="connect-btn" class="btn btn-light col">Join</button>
				</div>

				<div class="row">
					<input type="text" class="form-control col" id="msg-input" placeholder="Co?"/>
					<input type="text" class="form-control col" id="receiver-input" placeholder="Komu?"/>
				</div>
				<button id="send-msg-btn" class="btn btn-dark mt-3 w-100">Send</button>
			</section>

			<ul id="online" class="w-50 text-center col overflow-auto">
				<h2>Online now</h2>
			</ul>

		</section>

		<section id="result" class="w-100 p-5 bg-light overflow-auto">
		</section>		
	</main>
</body>

<script>
$(document).ready(function() {
console.log("We started.");

$("#connect-btn").on("click", function () {
    const socket = io.connect('http://' + document.domain + ':' + location.port);

    socket.on("connect", function () {
        let username = $("#username-input").val()
        socket.send(username);
        //socket.send("usernames_request");
    });

    socket.on("message", function (msg) {
        if (Array.isArray(msg)) {
            if (msg[0] == "usernames") {
                $("#online").append("<li>" + msg[1] + "</li>");
            } else if (msg[0] == "usernames_full") {
                for(let i = 0; i < msg[1].length; i++) {
                    $("#online").append("<li>" + msg[1][i] + "</li>");
                }
            } else {
                $("#result").append(msg[0] + ": " + msg[1] + "<br/>");
            }
        }   
    });		
    
    $("#send-msg-btn").on("click", function () {
        let msg = [$("#receiver-input").val(), $("#msg-input").val()];
        console.log(msg);
        socket.send(msg);
    });
});

});
</script>
</html>
